<!DOCTYPE html>

<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script type="text/javascript" src="lib/jquery.min.js"></script>
    <script type="text/javascript" src="lib/osql.js"></script>

    <script>
        osql.requireLogin();

        $().ready(function () {
            selectTopic();
            participant();
        });

        //トピック表示
        async function selectTopic() {
            var topic = osql.getParam('topic');
            document.getElementById('page').innerHTML = topic;

        }

        async function participant() {
            var topicid = osql.getParam('topicid');
            var memberid = osql.getParam('memberid');
            console.log(topicid);
            console.log(memberid);

            var sql = `insert into Topic_Member (topicid,memberid,status,created_at) values("${topicid}", "${memberid}", '未',now())`;
            var objects = await osql.connect(sql);
            console.log(objects);
            
            var sql2 = `select * from Topic_Member where topicid = "${topicid}" and memberid = "${memberid}" and status = "未"`;
            var objects2 = await osql.connect(sql2);
            console.log(objects2);

            while(objects2[0].status == '未'){
                if(objects2[0].status != '未'){
                    location.href = 'decide.html';
                    break;
                }
            }
        
        }




    </script>

</head>

<body>
    <h1 id="page"></h1>
    <p>グループ分けの結果は<a href="decide.html">こちら</a>から</p>
    <div>
        <p id='attend'></p>
        <p id='count'></p>
    </div>


</body>

</html>